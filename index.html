<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé∏ Chord Viewer - ‡πÅ‡∏≠‡∏õ‡∏î‡∏π‡∏Ñ‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏û‡∏•‡∏á</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --accent: #4a90e2;
            --accent-hover: #357abd;
            --border: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --chord-bg: #fff8dc;
            --chord-text: #d97706;
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --accent: #5ba3f5;
            --accent-hover: #4a90e2;
            --border: #495057;
            --shadow: rgba(0, 0, 0, 0.3);
            --chord-bg: #3a2f1a;
            --chord-text: #fbbf24;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            background: var(--bg-secondary);
            padding: 20px 0;
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            background: var(--accent);
            color: white;
            font-weight: 500;
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-icon {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .btn-icon:hover {
            background: var(--bg-tertiary);
        }

        /* Search Bar */
        .search-bar {
            margin: 20px 0;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            transition: border 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid var(--border);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 16px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab:hover {
            color: var(--accent);
        }

        /* Song Grid */
        .song-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .song-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border);
            position: relative;
        }

        .song-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px var(--shadow);
            border-color: var(--accent);
        }

        .song-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .song-artist {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .song-tags {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .tag {
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .favorite-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .favorite-icon:hover {
            transform: scale(1.2);
        }

        /* Chord Viewer */
        .chord-viewer {
            display: none;
        }

        .chord-viewer.active {
            display: block;
        }

        .viewer-header {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .song-info h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .song-info p {
            color: var(--text-secondary);
        }

        .viewer-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Control Panel */
        .control-panel {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            position: sticky;
            top: 80px;
            z-index: 90;
            box-shadow: 0 4px 10px var(--shadow);
        }

        .control-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .control-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-label {
            font-weight: 500;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .key-display {
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        /* Chord Reference */
        .chord-reference {
            background: var(--chord-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid var(--chord-text);
        }

        .chord-reference h3 {
            color: var(--chord-text);
            margin-bottom: 10px;
            font-size: 16px;
        }

        .chord-list {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .chord-item {
            background: white;
            color: var(--chord-text);
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            border: 2px solid var(--chord-text);
        }

        [data-theme="dark"] .chord-item {
            background: var(--bg-primary);
        }

        /* Lyrics Display */
        .lyrics-container {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            line-height: 2;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            font-size: 16px;
        }

        .lyrics-line {
            margin-bottom: 10px;
        }

        .chord-line {
            color: var(--chord-text);
            font-weight: bold;
            font-size: 14px;
            display: block;
        }

        .lyrics-line.hide-chords .chord-line {
            display: none;
        }

        .text-line {
            color: var(--text-primary);
        }

        /* Form */
        .song-form {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 16px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 300px;
            font-family: 'Courier New', monospace;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 20px;
        }

        /* Range Slider */
        input[type="range"] {
            width: 150px;
            height: 6px;
            border-radius: 3px;
            background: var(--border);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            border: none;
        }

        /* Artist List */
        .artist-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .artist-item {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid var(--border);
        }

        .artist-item:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        .artist-name {
            font-weight: bold;
            font-size: 16px;
        }

        .artist-count {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .artist-item:hover .artist-count {
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .song-grid {
                grid-template-columns: 1fr;
            }

            .control-group {
                flex-direction: column;
                align-items: stretch;
            }

            .control-item {
                justify-content: space-between;
            }

            .header-content {
                flex-direction: column;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        /* Font Size Classes */
        .font-xs .lyrics-container {
            font-size: 12px;
        }

        .font-sm .lyrics-container {
            font-size: 14px;
        }

        .font-md .lyrics-container {
            font-size: 16px;
        }

        .font-lg .lyrics-container {
            font-size: 18px;
        }

        .font-xl .lyrics-container {
            font-size: 20px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .empty-state-text {
            font-size: 18px;
        }
    </style>
</head>
<body data-theme="light">
    <header>
        <div class="header-content">
            <div class="logo">üé∏ Chord Viewer</div>
            <div class="header-actions">
                <button class="btn-icon" id="themeToggle" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏°">üåô</button>
                <button class="btn" id="exportBtn">üíæ Export</button>
                <button class="btn" id="importBtn">üì• Import</button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏û‡∏•‡∏á, ‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô, ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ó‡πá‡∏Å...">
            <span class="search-icon">üîç</span>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="all">üìö ‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            <button class="tab" data-tab="artists">üë®‚Äçüé§ ‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô</button>
            <button class="tab" data-tab="favorites">‚≠ê ‡πÄ‡∏û‡∏•‡∏á‡πÇ‡∏õ‡∏£‡∏î</button>
            <button class="tab" data-tab="add">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á</button>
        </div>

        <!-- All Songs Tab -->
        <div id="allTab" class="tab-content">
            <div id="songGrid" class="song-grid"></div>
            <div id="allEmptyState" class="empty-state hidden">
                <div class="empty-state-icon">üéµ</div>
                <div class="empty-state-text">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
            </div>
        </div>

        <!-- Artists Tab -->
        <div id="artistsTab" class="tab-content hidden">
            <div id="artistList" class="artist-list"></div>
        </div>

        <!-- Favorites Tab -->
        <div id="favoritesTab" class="tab-content hidden">
            <div id="favoriteGrid" class="song-grid"></div>
            <div id="favEmptyState" class="empty-state hidden">
                <div class="empty-state-icon">‚≠ê</div>
                <div class="empty-state-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏•‡∏á‡πÇ‡∏õ‡∏£‡∏î<br>‡∏Å‡∏î‡∏î‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏õ‡∏£‡∏î</div>
            </div>
        </div>

        <!-- Add Song Tab -->
        <div id="addTab" class="tab-content hidden">
            <form id="songForm" class="song-form">
                <h2 class="text-center mb-20">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà</h2>
                <div class="form-group">
                    <label for="songTitle">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á *</label>
                    <input type="text" id="songTitle" required>
                </div>
                <div class="form-group">
                    <label for="songArtist">‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô *</label>
                    <input type="text" id="songArtist" required>
                </div>
                <div class="form-group">
                    <label for="songKey">‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô *</label>
                    <select id="songKey" required>
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="songTags">‡πÅ‡∏ó‡πá‡∏Å (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</label>
                    <input type="text" id="songTags" placeholder="‡πÄ‡∏ä‡πà‡∏ô: Pop, Ballad, Love">
                </div>
                <div class="form-group">
                    <label for="songLyrics">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á + ‡∏Ñ‡∏≠‡∏£‡πå‡∏î *</label>
                    <textarea id="songLyrics" required placeholder="‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:&#10;[C]‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á [G]‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á&#10;‡∏´‡∏£‡∏∑‡∏≠&#10;[C]      [G]&#10;‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelForm">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>

        <!-- Chord Viewer -->
        <div id="chordViewer" class="chord-viewer">
            <div class="viewer-header">
                <div class="song-info">
                    <h2 id="viewerTitle"></h2>
                    <p id="viewerArtist"></p>
                </div>
                <div class="viewer-actions">
                    <button class="btn-icon" id="favoriteBtn" title="‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡πÇ‡∏õ‡∏£‡∏î">‚òÜ</button>
                    <button class="btn btn-secondary" id="editBtn">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button class="btn btn-secondary" id="deleteBtn">üóëÔ∏è ‡∏•‡∏ö</button>
                    <button class="btn btn-secondary" id="backBtn">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                </div>
            </div>

            <div class="control-panel">
                <div class="control-group">
                    <div class="control-item">
                        <span class="control-label">Transpose:</span>
                        <button class="btn btn-secondary" id="transposeDown">-</button>
                        <div class="key-display" id="currentKey">C</div>
                        <button class="btn btn-secondary" id="transposeUp">+</button>
                        <button class="btn btn-secondary" id="resetKey">Reset</button>
                    </div>
                    <div class="control-item">
                        <span class="control-label">‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£:</span>
                        <button class="btn btn-secondary" id="fontDown">A-</button>
                        <button class="btn btn-secondary" id="fontUp">A+</button>
                    </div>
                    <div class="control-item">
                        <button class="btn btn-secondary" id="toggleChords">üéµ ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏î</button>
                    </div>
                </div>
                <div class="control-group mt-20">
                    <div class="control-item">
                        <button class="btn" id="autoScrollBtn">‚ñ∂Ô∏è Auto-scroll</button>
                        <span class="control-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß:</span>
                        <input type="range" id="scrollSpeed" min="1" max="10" value="5" step="1">
                        <span id="speedDisplay">5x</span>
                    </div>
                </div>
            </div>

            <div class="chord-reference" id="chordReference">
                <h3>üé∏ ‡∏Ñ‡∏≠‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏û‡∏•‡∏á:</h3>
                <div class="chord-list" id="chordList"></div>
            </div>

            <div class="lyrics-container font-md" id="lyricsDisplay"></div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏•‡∏á</h3>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label for="editTitle">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á *</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-group">
                    <label for="editArtist">‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô *</label>
                    <input type="text" id="editArtist" required>
                </div>
                <div class="form-group">
                    <label for="editKey">‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô *</label>
                    <select id="editKey" required>
                        <option value="C">C</option>
                        <option value="C#">C#</option>
                        <option value="D">D</option>
                        <option value="D#">D#</option>
                        <option value="E">E</option>
                        <option value="F">F</option>
                        <option value="F#">F#</option>
                        <option value="G">G</option>
                        <option value="G#">G#</option>
                        <option value="A">A</option>
                        <option value="A#">A#</option>
                        <option value="B">B</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editTags">‡πÅ‡∏ó‡πá‡∏Å (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∏‡∏•‡∏†‡∏≤‡∏Ñ)</label>
                    <input type="text" id="editTags">
                </div>
                <div class="form-group">
                    <label for="editLyrics">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏á + ‡∏Ñ‡∏≠‡∏£‡πå‡∏î *</label>
                    <textarea id="editLyrics" required></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelEdit">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample Songs Data
        const SAMPLE_SONGS = [
            {
                id: 'sample1',
                title: '‡∏Ç‡∏≠‡πÉ‡∏à‡πÄ‡∏ò‡∏≠‡πÅ‡∏•‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£',
                artist: 'Golf Pichaya',
                key: 'C',
                tags: ['Pop', 'Love'],
                lyrics: `[C]      [G]        [Am]    [F]
‡∏Ç‡∏≠‡πÉ‡∏à‡πÄ‡∏ò‡∏≠‡πÅ‡∏•‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏ô‡∏î‡∏µ
[C]        [G]           [Am]   [F]
‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠‡πÑ‡∏õ‡∏ô‡∏≤‡∏ô‡πÜ ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
[C]      [G]      [Am]       [F]
‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ò‡∏≠
[C]        [G]        [Am]    [F]
‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡∏°‡∏µ‡πÉ‡∏à‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏™‡∏±‡∏Å‡∏ó‡∏µ`
            },
            {
                id: 'sample2',
                title: '‡∏Ñ‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç',
                artist: '‡πÄ‡∏≠‡πä‡∏∞ ‡∏à‡∏¥‡∏£‡∏≤‡∏Å‡∏£',
                key: 'G',
                tags: ['Ballad', 'Love'],
                lyrics: `[G]           [D]        [Em]     [C]
‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏ò‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£ ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ
[G]         [D]          [Em]      [C]
‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏â‡∏¢‡∏ä‡∏≤ ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡πÉ‡∏à
[G]           [D]        [Em]        [C]
‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏ò‡∏≠‡∏ô‡∏±‡πâ‡∏ô‡∏î‡∏µ ‡∏ó‡∏µ‡πà‡∏°‡∏≠‡∏á‡∏â‡∏±‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç
[G]         [D]        [Em]    [C]
‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà`
            },
            {
                id: 'sample3',
                title: '‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠',
                artist: 'Pause',
                key: 'D',
                tags: ['Pop', 'Indie'],
                lyrics: `[D]           [A]        [Bm]      [G]
‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡πÄ‡∏ò‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÉ‡∏à
[D]         [A]          [Bm]       [G]
‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
[D]           [A]        [Bm]        [G]
‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
[D]         [A]        [Bm]    [G]
‡πÅ‡∏ï‡πà‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏î‡∏±‡πà‡∏á‡∏ù‡∏±‡∏ô ‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏°‡∏µ`
            },
            {
                id: 'sample4',
                title: '‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ',
                artist: '‡∏ä‡∏≤‡∏£‡πå‡∏•‡∏µ ‡∏†‡∏π‡∏ò‡∏£',
                key: 'Am',
                tags: ['Ballad', 'Sad'],
                lyrics: `[Am]        [F]         [C]        [G]
‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£
[Am]        [F]         [C]         [G]
‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ä‡πà‡∏ß‡∏¢ ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ö‡∏≤‡∏î‡πÅ‡∏ú‡∏•
[Am]        [F]         [C]        [G]
‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏ò‡∏≠‡∏à‡∏≤‡∏Å‡πÑ‡∏õ ‡∏ó‡∏¥‡πâ‡∏á‡∏â‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
[Am]        [F]         [C]    [G]
‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ`
            },
            {
                id: 'sample5',
                title: '‡πÉ‡∏à‡πÄ‡∏ò‡∏≠‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤',
                artist: '‡πÅ‡∏™‡∏ï‡∏°‡∏õ‡πå',
                key: 'E',
                tags: ['Pop', 'Love'],
                lyrics: `[E]           [B]        [C#m]     [A]
‡πÉ‡∏à‡πÄ‡∏ò‡∏≠‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á
[E]         [B]          [C#m]      [A]
‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡πÄ‡∏ò‡∏≠‡∏¢‡∏±‡∏á‡πÇ‡∏™‡∏î ‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
[E]           [B]        [C#m]        [A]
‡∏ñ‡πâ‡∏≤‡πÄ‡∏ò‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£ ‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°
[E]         [B]        [C#m]    [A]
‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏î‡∏π‡πÅ‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡πÄ‡∏ò‡∏≠ ‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ`
            }
        ];

        // State Management
        let songs = [];
        let favorites = [];
        let currentSong = null;
        let currentTab = 'all';
        let currentTranspose = 0;
        let originalKey = '';
        let fontSize = 'font-md';
        let showChords = true;
        let autoScrollInterval = null;
        let scrollSpeed = 5;
        let searchQuery = '';

        // Chord Notes
        const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

        // Initialize App
        function init() {
            loadData();
            setupEventListeners();
            renderSongs();
            
            // Theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        // Load Data from LocalStorage
        function loadData() {
            const savedSongs = localStorage.getItem('userSongs');
            const userSongs = savedSongs ? JSON.parse(savedSongs) : [];
            songs = [...SAMPLE_SONGS, ...userSongs];
            
            const savedFavorites = localStorage.getItem('favorites');
            favorites = savedFavorites ? JSON.parse(savedFavorites) : [];
        }

        // Save User Songs to LocalStorage
        function saveUserSongs() {
            const userSongs = songs.filter(song => !song.id.startsWith('sample'));
            localStorage.setItem('userSongs', JSON.stringify(userSongs));
        }

        // Save Favorites
        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchQuery = e.target.value.toLowerCase();
                renderSongs();
            });

            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Export/Import
            document.getElementById('exportBtn').addEventListener('click', exportData);
            document.getElementById('importBtn').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });
            document.getElementById('importFile').addEventListener('change', importData);

            // Song Form
            document.getElementById('songForm').addEventListener('submit', addSong);
            document.getElementById('cancelForm').addEventListener('click', () => {
                document.getElementById('songForm').reset();
            });

            // Viewer Controls
            document.getElementById('backBtn').addEventListener('click', closeViewer);
            document.getElementById('transposeUp').addEventListener('click', () => transpose(1));
            document.getElementById('transposeDown').addEventListener('click', () => transpose(-1));
            document.getElementById('resetKey').addEventListener('click', resetTranspose);
            document.getElementById('fontUp').addEventListener('click', increaseFontSize);
            document.getElementById('fontDown').addEventListener('click', decreaseFontSize);
            document.getElementById('toggleChords').addEventListener('click', toggleChords);
            document.getElementById('autoScrollBtn').addEventListener('click', toggleAutoScroll);
            document.getElementById('scrollSpeed').addEventListener('input', (e) => {
                scrollSpeed = parseInt(e.target.value);
                document.getElementById('speedDisplay').textContent = scrollSpeed + 'x';
                if (autoScrollInterval) {
                    stopAutoScroll();
                    startAutoScroll();
                }
            });

            // Edit/Delete
            document.getElementById('editBtn').addEventListener('click', openEditModal);
            document.getElementById('deleteBtn').addEventListener('click', deleteSong);
            document.getElementById('favoriteBtn').addEventListener('click', toggleFavorite);

            // Edit Modal
            document.getElementById('editForm').addEventListener('submit', saveEdit);
            document.getElementById('cancelEdit').addEventListener('click', closeEditModal);
            document.getElementById('editModal').addEventListener('click', (e) => {
                if (e.target.id === 'editModal') closeEditModal();
            });

            // Keyboard Shortcuts
            document.addEventListener('keydown', handleKeyboardShortcuts);
        }

        // Switch Tab
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });

            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Show selected tab
            const tabMap = {
                'all': 'allTab',
                'artists': 'artistsTab',
                'favorites': 'favoritesTab',
                'add': 'addTab'
            };

            document.getElementById(tabMap[tab]).classList.remove('hidden');

            // Render content
            if (tab === 'all') {
                renderSongs();
            } else if (tab === 'artists') {
                renderArtists();
            } else if (tab === 'favorites') {
                renderFavorites();
            }
        }

        // Render Songs
        function renderSongs() {
            const grid = document.getElementById('songGrid');
            const emptyState = document.getElementById('allEmptyState');
            
            let filteredSongs = songs;
            
            if (searchQuery) {
                filteredSongs = songs.filter(song => 
                    song.title.toLowerCase().includes(searchQuery) ||
                    song.artist.toLowerCase().includes(searchQuery) ||
                    song.tags.some(tag => tag.toLowerCase().includes(searchQuery))
                );
            }

            if (filteredSongs.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            grid.innerHTML = filteredSongs.map(song => createSongCard(song)).join('');

            // Add click events
            grid.querySelectorAll('.song-card').forEach(card => {
                const songId = card.dataset.id;
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('favorite-icon')) {
                        openViewer(songId);
                    }
                });
            });

            // Add favorite events
            grid.querySelectorAll('.favorite-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const songId = icon.closest('.song-card').dataset.id;
                    toggleFavoriteFromCard(songId);
                });
            });
        }

        // Create Song Card
        function createSongCard(song) {
            const isFavorite = favorites.includes(song.id);
            return `
                <div class="song-card" data-id="${song.id}">
                    <span class="favorite-icon">${isFavorite ? '‚òÖ' : '‚òÜ'}</span>
                    <div class="song-title">${song.title}</div>
                    <div class="song-artist">üé§ ${song.artist}</div>
                    <div class="song-tags">
                        ${song.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `;
        }

        // Render Artists
        function renderArtists() {
            const artistList = document.getElementById('artistList');
            const artistMap = {};

            songs.forEach(song => {
                if (!artistMap[song.artist]) {
                    artistMap[song.artist] = [];
                }
                artistMap[song.artist].push(song);
            });

            const artists = Object.keys(artistMap).sort();

            artistList.innerHTML = artists.map(artist => `
                <div class="artist-item" data-artist="${artist}">
                    <div class="artist-name">üë®‚Äçüé§ ${artist}</div>
                    <div class="artist-count">${artistMap[artist].length} ‡πÄ‡∏û‡∏•‡∏á</div>
                </div>
            `).join('');

            artistList.querySelectorAll('.artist-item').forEach(item => {
                item.addEventListener('click', () => {
                    const artist = item.dataset.artist;
                    searchQuery = artist.toLowerCase();
                    document.getElementById('searchInput').value = artist;
                    switchTab('all');
                });
            });
        }

        // Render Favorites
        function renderFavorites() {
            const grid = document.getElementById('favoriteGrid');
            const emptyState = document.getElementById('favEmptyState');
            
            const favoriteSongs = songs.filter(song => favorites.includes(song.id));

            if (favoriteSongs.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            grid.innerHTML = favoriteSongs.map(song => createSongCard(song)).join('');

            // Add click events
            grid.querySelectorAll('.song-card').forEach(card => {
                const songId = card.dataset.id;
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('favorite-icon')) {
                        openViewer(songId);
                    }
                });
            });

            // Add favorite events
            grid.querySelectorAll('.favorite-icon').forEach(icon => {
                icon.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const songId = icon.closest('.song-card').dataset.id;
                    toggleFavoriteFromCard(songId);
                });
            });
        }

        // Add Song
        function addSong(e) {
            e.preventDefault();

            const title = document.getElementById('songTitle').value.trim();
            const artist = document.getElementById('songArtist').value.trim();
            const key = document.getElementById('songKey').value;
            const tagsInput = document.getElementById('songTags').value.trim();
            const lyrics = document.getElementById('songLyrics').value.trim();

            const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];

            const newSong = {
                id: 'user-' + Date.now(),
                title,
                artist,
                key,
                tags,
                lyrics
            };

            songs.push(newSong);
            saveUserSongs();
            
            document.getElementById('songForm').reset();
            alert('‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            
            switchTab('all');
        }

        // Open Viewer
        function openViewer(songId) {
            currentSong = songs.find(s => s.id === songId);
            if (!currentSong) return;

            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.getElementById('chordViewer').classList.add('active');
            
            // Update header
            document.getElementById('viewerTitle').textContent = currentSong.title;
            document.getElementById('viewerArtist').textContent = 'üé§ ' + currentSong.artist;

            // Reset transpose
            currentTranspose = 0;
            originalKey = currentSong.key;
            document.getElementById('currentKey').textContent = originalKey;

            // Update favorite button
            updateFavoriteButton();

            // Render lyrics
            renderLyrics();

            // Render chord reference
            renderChordReference();

            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Close Viewer
        function closeViewer() {
            document.getElementById('chordViewer').classList.remove('active');
            document.getElementById('allTab').classList.remove('hidden');
            stopAutoScroll();
            currentSong = null;
        }

        // Render Lyrics
        function renderLyrics() {
            const lyricsDisplay = document.getElementById('lyricsDisplay');
            const lines = currentSong.lyrics.split('\n');
            
            let html = '';
            let i = 0;

            while (i < lines.length) {
                const line = lines[i];
                
                // Check if line contains chords
                if (line.includes('[') && line.includes(']')) {
                    const nextLine = lines[i + 1] || '';
                    
                    // If next line doesn't have chords, it's lyrics
                    if (!nextLine.includes('[') || !nextLine.includes(']')) {
                        html += `<div class="lyrics-line">`;
                        html += `<span class="chord-line">${processChordLine(line)}</span>`;
                        html += `<span class="text-line">${nextLine}</span>`;
                        html += `</div>`;
                        i += 2;
                    } else {
                        // Only chords
                        html += `<div class="lyrics-line">`;
                        html += `<span class="chord-line">${processChordLine(line)}</span>`;
                        html += `</div>`;
                        i += 1;
                    }
                } else {
                    // Regular text line
                    html += `<div class="lyrics-line">`;
                    html += `<span class="text-line">${line}</span>`;
                    html += `</div>`;
                    i += 1;
                }
            }

            lyricsDisplay.innerHTML = html;
        }

        // Process Chord Line
        function processChordLine(line) {
            return line.replace(/\[([^\]]+)\]/g, (match, chord) => {
                const transposedChord = transposeChord(chord, currentTranspose);
                return `<strong style="color: var(--chord-text);">${transposedChord}</strong>`;
            });
        }

        // Transpose Chord
        function transposeChord(chord, steps) {
            if (steps === 0) return chord;

            // Extract base note and suffix
            const match = chord.match(/^([A-G][#b]?)(.*)/);
            if (!match) return chord;

            let [, note, suffix] = match;

            // Normalize sharps and flats
            note = note.replace('b', '#');
            if (note === 'Db') note = 'C#';
            if (note === 'Eb') note = 'D#';
            if (note === 'Gb') note = 'F#';
            if (note === 'Ab') note = 'G#';
            if (note === 'Bb') note = 'A#';

            // Find current position
            let index = NOTES.indexOf(note);
            if (index === -1) return chord;

            // Transpose
            index = (index + steps) % 12;
            if (index < 0) index += 12;

            return NOTES[index] + suffix;
        }

        // Transpose
        function transpose(steps) {
            currentTranspose += steps;
            
            const keyIndex = NOTES.indexOf(originalKey);
            let newIndex = (keyIndex + currentTranspose) % 12;
            if (newIndex < 0) newIndex += 12;
            
            document.getElementById('currentKey').textContent = NOTES[newIndex];
            renderLyrics();
            renderChordReference();
        }

        // Reset Transpose
        function resetTranspose() {
            currentTranspose = 0;
            document.getElementById('currentKey').textContent = originalKey;
            renderLyrics();
            renderChordReference();
        }

        // Render Chord Reference
        function renderChordReference() {
            const chordList = document.getElementById('chordList');
            const chords = extractChords(currentSong.lyrics);
            
            const uniqueChords = [...new Set(chords)].map(chord => 
                transposeChord(chord, currentTranspose)
            );

            chordList.innerHTML = uniqueChords.map(chord => 
                `<div class="chord-item">${chord}</div>`
            ).join('');
        }

        // Extract Chords
        function extractChords(lyrics) {
            const matches = lyrics.match(/\[([^\]]+)\]/g);
            if (!matches) return [];
            return matches.map(match => match.replace(/[\[\]]/g, ''));
        }

        // Font Size Control
        function increaseFontSize() {
            const sizes = ['font-xs', 'font-sm', 'font-md', 'font-lg', 'font-xl'];
            const currentIndex = sizes.indexOf(fontSize);
            if (currentIndex < sizes.length - 1) {
                fontSize = sizes[currentIndex + 1];
                updateFontSize();
            }
        }

        function decreaseFontSize() {
            const sizes = ['font-xs', 'font-sm', 'font-md', 'font-lg', 'font-xl'];
            const currentIndex = sizes.indexOf(fontSize);
            if (currentIndex > 0) {
                fontSize = sizes[currentIndex - 1];
                updateFontSize();
            }
        }

        function updateFontSize() {
            const container = document.getElementById('lyricsDisplay');
            container.className = 'lyrics-container ' + fontSize;
        }

        // Toggle Chords
        function toggleChords() {
            showChords = !showChords;
            const lines = document.querySelectorAll('.lyrics-line');
            const btn = document.getElementById('toggleChords');
            
            if (showChords) {
                lines.forEach(line => line.classList.remove('hide-chords'));
                btn.textContent = 'üéµ ‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≠‡∏£‡πå‡∏î';
            } else {
                lines.forEach(line => line.classList.add('hide-chords'));
                btn.textContent = 'üéµ ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≠‡∏£‡πå‡∏î';
            }
        }

        // Auto Scroll
        function toggleAutoScroll() {
            if (autoScrollInterval) {
                stopAutoScroll();
            } else {
                startAutoScroll();
            }
        }

        function startAutoScroll() {
            const btn = document.getElementById('autoScrollBtn');
            btn.textContent = '‚è∏Ô∏è ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô';
            btn.classList.add('btn');
            btn.classList.remove('btn-secondary');
            
            autoScrollInterval = setInterval(() => {
                window.scrollBy(0, scrollSpeed);
                
                // Stop at bottom
                if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
                    stopAutoScroll();
                }
            }, 100);
        }

        function stopAutoScroll() {
            if (autoScrollInterval) {
                clearInterval(autoScrollInterval);
                autoScrollInterval = null;
                
                const btn = document.getElementById('autoScrollBtn');
                btn.textContent = '‚ñ∂Ô∏è Auto-scroll';
                btn.classList.remove('btn');
                btn.classList.add('btn-secondary');
            }
        }

        // Toggle Favorite
        function toggleFavorite() {
            if (!currentSong) return;
            
            const index = favorites.indexOf(currentSong.id);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(currentSong.id);
            }
            
            saveFavorites();
            updateFavoriteButton();
            renderSongs();
            renderFavorites();
        }

        function toggleFavoriteFromCard(songId) {
            const index = favorites.indexOf(songId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(songId);
            }
            
            saveFavorites();
            renderSongs();
            renderFavorites();
        }

        function updateFavoriteButton() {
            const btn = document.getElementById('favoriteBtn');
            btn.textContent = favorites.includes(currentSong.id) ? '‚òÖ' : '‚òÜ';
        }

        // Edit Song
        function openEditModal() {
            if (!currentSong) return;

            document.getElementById('editTitle').value = currentSong.title;
            document.getElementById('editArtist').value = currentSong.artist;
            document.getElementById('editKey').value = currentSong.key;
            document.getElementById('editTags').value = currentSong.tags.join(', ');
            document.getElementById('editLyrics').value = currentSong.lyrics;

            document.getElementById('editModal').classList.add('active');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        function saveEdit(e) {
            e.preventDefault();

            if (!currentSong) return;

            currentSong.title = document.getElementById('editTitle').value.trim();
            currentSong.artist = document.getElementById('editArtist').value.trim();
            currentSong.key = document.getElementById('editKey').value;
            
            const tagsInput = document.getElementById('editTags').value.trim();
            currentSong.tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];
            
            currentSong.lyrics = document.getElementById('editLyrics').value.trim();

            // Update original key
            originalKey = currentSong.key;
            currentTranspose = 0;

            saveUserSongs();
            closeEditModal();
            
            // Update viewer
            document.getElementById('viewerTitle').textContent = currentSong.title;
            document.getElementById('viewerArtist').textContent = 'üé§ ' + currentSong.artist;
            document.getElementById('currentKey').textContent = currentSong.key;
            renderLyrics();
            renderChordReference();
            
            alert('‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        // Delete Song
        function deleteSong() {
            if (!currentSong) return;

            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á "${currentSong.title}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                // Can't delete sample songs
                if (currentSong.id.startsWith('sample')) {
                    alert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ');
                    return;
                }

                songs = songs.filter(s => s.id !== currentSong.id);
                
                // Remove from favorites
                const favIndex = favorites.indexOf(currentSong.id);
                if (favIndex > -1) {
                    favorites.splice(favIndex, 1);
                    saveFavorites();
                }

                saveUserSongs();
                closeViewer();
                renderSongs();
                
                alert('‚úÖ ‡∏•‡∏ö‡πÄ‡∏û‡∏•‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            }
        }

        // Theme Toggle
        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            document.getElementById('themeToggle').textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        // Export Data
        function exportData() {
            const userSongs = songs.filter(song => !song.id.startsWith('sample'));
            
            const data = {
                songs: userSongs,
                favorites: favorites,
                exportDate: new Date().toISOString()
            };

            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `my-songs-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            URL.revokeObjectURL(url);
            alert('‚úÖ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        // Import Data
        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    if (!data.songs || !Array.isArray(data.songs)) {
                        throw new Error('Invalid format');
                    }

                    if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏•‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?\n\n‡∏Å‡∏î OK = ‡∏£‡∏ß‡∏°, ‡∏Å‡∏î Cancel = ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà')) {
                        // Merge
                        const existingIds = songs.map(s => s.id);
                        const newSongs = data.songs.filter(s => !existingIds.includes(s.id));
                        songs = [...songs, ...newSongs];
                    } else {
                        // Replace
                        songs = [...SAMPLE_SONGS, ...data.songs];
                    }

                    if (data.favorites) {
                        favorites = data.favorites;
                    }

                    saveUserSongs();
                    saveFavorites();
                    renderSongs();
                    
                    alert('‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                } catch (error) {
                    alert('‚ùå ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!');
                }
            };
            
            reader.readAsText(file);
            e.target.value = '';
        }

        // Keyboard Shortcuts
        function handleKeyboardShortcuts(e) {
            if (document.getElementById('chordViewer').classList.contains('active')) {
                // Only in viewer
                if (e.code === 'Space' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    toggleAutoScroll();
                } else if (e.code === 'ArrowUp' && e.ctrlKey) {
                    e.preventDefault();
                    if (scrollSpeed < 10) {
                        scrollSpeed++;
                        document.getElementById('scrollSpeed').value = scrollSpeed;
                        document.getElementById('speedDisplay').textContent = scrollSpeed + 'x';
                        if (autoScrollInterval) {
                            stopAutoScroll();
                            startAutoScroll();
                        }
                    }
                } else if (e.code === 'ArrowDown' && e.ctrlKey) {
                    e.preventDefault();
                    if (scrollSpeed > 1) {
                        scrollSpeed--;
                        document.getElementById('scrollSpeed').value = scrollSpeed;
                        document.getElementById('speedDisplay').textContent = scrollSpeed + 'x';
                        if (autoScrollInterval) {
                            stopAutoScroll();
                            startAutoScroll();
                        }
                    }
                } else if (e.code === 'Equal' || e.code === 'NumpadAdd') {
                    e.preventDefault();
                    transpose(1);
                } else if (e.code === 'Minus' || e.code === 'NumpadSubtract') {
                    e.preventDefault();
                    transpose(-1);
                } else if (e.code === 'KeyH') {
                    e.preventDefault();
                    toggleChords();
                } else if (e.code === 'Escape') {
                    e.preventDefault();
                    closeViewer();
                }
            }
        }

        // Initialize on load
        init();
    </script>
</body>
</html>